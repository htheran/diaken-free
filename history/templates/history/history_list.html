{% extends 'base/base.html' %}
{% block title %}Deployment History{% endblock %}
{% block content %}
<div class="container-fluid">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title"><i class="fas fa-history"></i> Deployment History</h3>
    </div>
    
    <!-- Filtros -->
    <div class="card-body">
      <form method="get" class="form-inline mb-3">
        <label class="mr-2"><i class="fas fa-filter"></i> Filters:</label>
        
        <select name="status" class="form-control form-control-sm mr-2">
          <option value="">All Status</option>
          <option value="success" {% if status_filter == 'success' %}selected{% endif %}>Success</option>
          <option value="failed" {% if status_filter == 'failed' %}selected{% endif %}>Failed</option>
          <option value="running" {% if status_filter == 'running' %}selected{% endif %}>Running</option>
        </select>
        
        <select name="type" class="form-control form-control-sm mr-2">
          <option value="">All Types</option>
          <option value="VM" {% if type_filter == 'VM' %}selected{% endif %}>VM</option>
          <option value="Host" {% if type_filter == 'Host' %}selected{% endif %}>Host</option>
          <option value="Group" {% if type_filter == 'Group' %}selected{% endif %}>Group</option>
        </select>
        
        <label class="mr-2">From:</label>
        <input type="date" name="date_from" class="form-control form-control-sm mr-2" value="{{ date_from }}">
        
        <label class="mr-2">To:</label>
        <input type="date" name="date_to" class="form-control form-control-sm mr-2" value="{{ date_to }}">
        
        <button type="submit" class="btn btn-primary btn-sm mr-2"><i class="fas fa-search"></i> Filter</button>
        <a href="{% url 'history_list' %}" class="btn btn-secondary btn-sm"><i class="fas fa-eraser"></i> Clear</a>
      </form>
    </div>
    
    <!-- Tabla -->
    <div class="card-body p-0">
      <table class="table table-hover table-sm mb-0">
        <thead class="thead-light">
          <tr>
            <th style="width: 10%">User</th>
            <th style="width: 10%">Environment</th>
            <th style="width: 15%">Target</th>
            <th style="width: 20%">Playbook</th>
            <th style="width: 15%">Date</th>
            <th style="width: 10%" class="text-center">Status</th>
            <th style="width: 10%" class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for deployment in deployments %}
          <tr>
            <td><i class="fas fa-user"></i> {{ deployment.user.username|default:"Unknown" }}</td>
            <td><span class="badge badge-info">{{ deployment.environment }}</span></td>
            <td>
              {% if deployment.target_type == 'VM' %}
                <i class="fas fa-server"></i>
              {% elif deployment.target_type == 'Host' %}
                <i class="fas fa-desktop"></i>
              {% else %}
                <i class="fas fa-users"></i>
              {% endif %}
              <strong>{{ deployment.target }}</strong>
              <span class="badge badge-secondary">{{ deployment.target_type }}</span>
            </td>
            <td><i class="fas fa-file-code"></i> {{ deployment.playbook }}</td>
            <td><i class="far fa-calendar"></i> {{ deployment.created_at|date:"d/m/Y H:i" }}</td>
            <td class="text-center">
              {% if deployment.status == 'success' %}
                <span class="badge badge-success"><i class="fas fa-check-circle"></i> Success</span>
              {% elif deployment.status == 'failed' %}
                <span class="badge badge-danger"><i class="fas fa-times-circle"></i> Failed</span>
              {% else %}
                <span class="badge badge-warning"><i class="fas fa-spinner fa-spin"></i> Running</span>
              {% endif %}
            </td>
            <td class="text-center">
              <a href="{% url 'history_detail' deployment.pk %}" class="btn btn-sm btn-primary" title="View Details">
                <i class="fas fa-eye"></i> View
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted">No deployment history found</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
